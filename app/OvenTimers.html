<!DOCTYPE html>
<html lang="en-UK">
<head>
  <title>Oven Timer App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>  
  </style>
  <script src="external/jquery-3.7.1.js"></script>  
  <script src="./external/easytimer.js-master/dist/easytimer.js""></script>
  <script src="external/sweetalert2.all.js"></script>
  <link rel="stylesheet" href="external/sweetalert2.min.css">
  <link rel="stylesheet" href="base.css">
</head>
<body>
  <div class="toggle-ovens-header">
    <button class="toggle-oven" id="oven-btn-1" onclick=toggleOven(1)>Oven 1</button>
    <button class="toggle-oven" id="oven-btn-2" onclick=toggleOven(2)>Oven 2</button>
    <button class="toggle-oven" id="oven-btn-3" onclick=toggleOven(3)>Oven 3</button>
  </div>
  <div class="ovens-container">
      <div class="oven" id="oven-1"">
        <div class="oven-info-input" id="oven-info-input-1">
          <p class="oven-name">Oven 1</p>
          <div class="input-line">
            <p class="input-label">Name:</p>
            <input class="info-input" type="text" id="oven-name-1" value="Oven 1"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Time:</p>
            <input type="number" onKeyDown="return false" min="10" max="300" value="10" step="10" id="oven-time-1"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Temperature:</p>
            <input type="number" onKeyDown="return false" min="100" max="300" value="200" step="10" id="oven-temperature-1"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Slots:</p>
            <input type="number" onKeyDown="return false" max="12" min="2" step="2" value="2" id="oven-slots-1"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Customer:</p>
            <input type=text" id="oven-customer-1" value="ONT"></input>
          </div>

          <button class="submit-info" onclick=createGrid(1)>SUBMIT</button>
        </div>

        <div class="oven-info-display" id="oven-info-display-1">
          <p id="oven-name-display-1"></p>
          <p id="oven-time-display-1"></p>
          <p id="oven-temperature-display-1"></p>
        </div>

        <div class="oven-body" id="grid-1"></div>
      </div>

      <div class="oven" id="oven-2"">
        <div class="oven-info-input" id="oven-info-input-2">
          <p class="oven-name">Oven 2</p>
          <div class="input-line">
            <p class="input-label">Name:</p>
            <input class="info-input" type="text" id="oven-name-2" value="Oven 2"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Time:</p>
            <input type="number" onKeyDown="return false" min="10" max="300" value="10" step="10" id="oven-time-2"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Temperature:</p>
            <input type="number" onKeyDown="return false" min="100" max="300" value="200" step="10" id="oven-temperature-2"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Slots:</p>
            <input type="number" onKeyDown="return false" max="12" min="2" step="2" value="2" id="oven-slots-2"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Customer:</p>
            <input type=text" id="oven-customer-2" value="ONT"></input>
          </div>

          <button class="submit-info" onclick=createGrid(2)>SUBMIT</button>
        </div>

        <div class="oven-info-display" id="oven-info-display-2">
          <p id="oven-name-display-2"></p>
          <p id="oven-time-display-2"></p>
          <p id="oven-temperature-display-2"></p>
        </div>

        <div class="oven-body" id="grid-2"></div>
      </div>

      <div class="oven" id="oven-3"">
        <div class="oven-info-input" id="oven-info-input-3">
          <p class="oven-name">Oven 3</p>
          <div class="input-line">
            <p class="input-label">Name:</p>
            <input class="info-input" type="text" id="oven-name-3" value="Oven 3"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Time:</p>
            <input type="number" onKeyDown="return false" min="10" max="300" value="10" step="10" id="oven-time-3"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Temperature:</p>
            <input type="number" onKeyDown="return false" min="100" max="300" value="200" step="10" id="oven-temperature-3"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Slots:</p>
            <input type="number" onKeyDown="return false" max="12" min="2" step="2" value="2" id="oven-slots-3"></input>
          </div>

          <div class="input-line">
            <p class="input-label">Customer:</p>
            <input type=text" id="oven-customer-3" value="ONT"></input>
          </div>
          <button class="submit-info" onclick=createGrid(3)>SUBMIT</button>
        </div>

        <div class="oven-info-display" id="oven-info-display-3">
          <p id="oven-name-display-3"></p>
          <p id="oven-time-display-3"></p>
          <p id="oven-temperature-display-3"></p>
        </div>

        <div class="oven-body" id="grid-3"></div>
      </div>
  </div>
  <script>
    
    // To add another oven: add a dictionary entry to allSlots dict and duplicate/update HTML for an oven

    // Global Variables
    var allSlots = {
      oven1: {
        row1: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row2: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row3: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row4: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row5: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row6: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        }
      },
      oven2: {
        row1: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row2: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row3: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row4: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row5: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row6: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        }
      },
      oven3: {
        row1: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row2: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row3: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false
          },
        },
        row4: {
          column1: {
            slot: false,
            timer: false
          },
          column2: {
            slot: false,
            timer: false,
          },
        },
        row5: {
          column1: {
            slot: false,
            timer: false,
          },
          column2: {
            slot: false,
            timer: false,
          },
        },
        row6: {
          column1: {
            slot: false,
            timer: false,
          },
          column2: {
            slot: false,
            timer: false
          },
        }
      },
    };

    // CLASSES
    class ovenSlot {

      constructor(ovenNumber, row, column, duration) {
        this.ovenNumber = ovenNumber;
        this.row = row;
        this.column = column;
        this.slotString = createSlotString(ovenNumber, row, column);
        this.duration = duration;
      }


      // ovenSlot Methods
      createTimer() {
        let currentColumn = getColumnDict(this.ovenNumber, this.row, this.column); 
        let slotID = '#' + this.slotString;

        if ( currentColumn["timer"] == true ) {
          return
        } else {
          currentColumn["timer"] = true;
          currentColumn["timerEntity"] = new easytimer.Timer();
          currentColumn["timerEntity"].start({countdown: true, startValues: {seconds: this.duration*60}});
          currentColumn["timerEntity"].addEventListener('secondsUpdated', function (e) {
            $(slotID).html(currentColumn["timerEntity"].getTimeValues().toString());
          }); 

          let timerAlert = (
            "Oven: "      + this.ovenNumber + 
            "\nRow: "     + this.row + 
            "\nColumn: "  + this.column + 
            "\nDone"
          )

          currentColumn["timerEntity"].addEventListener('targetAchieved', function (e) {
            Swal.close();
            Swal.fire({
              title: timerAlert
            });
            currentColumn["timer"] = false;
            currentColumn["timerEntity"].reset();
            currentColumn["timerEntity"].stop();

            $(slotID).html("Done");

          });
        }
      }
    }

    // FUNCTIONS

    $( document ).ready(function() {
      // Functions that execute as soon as page loads
      $(".oven-info-input").hide()
      $(".oven-info-display").hide()
      $(".oven").hide()
    });

    function toggleOven(ovenNumber) {

      // Clear any pre-existing attributes
      $("#oven-name-display-" + (ovenNumber)).empty()
      $("#oven-temperature-display-" + (ovenNumber)).empty()
      $("#oven-time-display-" + (ovenNumber)).empty()

      let ovenID = "#oven-" + (ovenNumber);

      if ($(ovenID).is(":visible")){
        $("#oven-"+(ovenNumber)).hide()
        $("#grid-"+(ovenNumber)).empty();
      } else {
        $("#oven-"+(ovenNumber)).show()
        $("#oven-info-input-" + (ovenNumber)).show()
        $("#oven-info-display-" + (ovenNumber)).show()
        $
      }
    }


    function createGrid(ovenNumber) {
      
      // Get oven attributes
      $("#oven-info-input-" + (ovenNumber)).hide()
      let slots = $("#oven-slots-" + ovenNumber).val()/2;
      let duration = $("#oven-time-" + ovenNumber).val()

      // Create info display
      $("#oven-name-display-" + (ovenNumber)).html("Name: " + $("#oven-name-" + ovenNumber).val());
      $("#oven-temperature-display-" + (ovenNumber)).html("Temperature: " + $("#oven-temperature-" + ovenNumber).val() + " Â°C");
      $("#oven-time-display-" + (ovenNumber)).html("Time: " + $("#oven-time-" + ovenNumber).val() + " minutes");


      // Create grid
      $("#grid-"+(ovenNumber)).empty();

      var gridContent = "<table>";
      for(i=1; i<=slots; i++) {
        gridContent +="<tr class=oven-row>"
        for(j=1;j<=2;j++){
          let currentSlot = {
            ovenNumber: ovenNumber,
            row: i,
            column: j,
            duration: duration,
          }
          let slotString = "oven-"+ ovenNumber + "-row-" + i + "-column-" + j;
          gridContent += "<td class=oven-cell><button class='timer-btn' onclick=newTimer("+ JSON.stringify(currentSlot) +") ><div id="+ 
          slotString +">Start</div></button><button class='reset-btn' onclick=removeTimer("+ JSON.stringify(currentSlot) +")>X</button</td>"
        }
        gridContent +="</tr>"
      }
      gridContent += "</table>"
      $("#grid-" + (ovenNumber)).append(gridContent);
    }


    function newTimer(currentSlot) {
      // called on oven slot button press -> generates a timer with pre-entered settings
      let ovenNumber = currentSlot.ovenNumber;
      let row = currentSlot.row;
      let column = currentSlot.column;
      let duration = currentSlot.duration;

      var timerSlot = new ovenSlot(ovenNumber, row, column, duration) 
      timerSlot.createTimer()
    }


    function removeTimer(currentSlot) {
      let slotID = '#' + createSlotString(currentSlot.ovenNumber, currentSlot.row, currentSlot.column);
      let currentColumn = getColumnDict(currentSlot.ovenNumber, currentSlot.row, currentSlot.column);

      currentColumn["timer"] = false;
      currentColumn["timerEntity"].reset();
      currentColumn["timerEntity"].stop();

      $(slotID).html("Start");
    }


    function getColumnDict(ovenNumber, row, column){
      let ovenDict = allSlots["oven"+ovenNumber];
      let rowDict = ovenDict["row"+row];
      let columnDict = rowDict["column"+column];

      return columnDict
    }


    function createSlotString(ovenNumber, row, column){
      let slotString = "oven-"+ ovenNumber + "-row-" + row + "-column-" + column;

      return slotString
    }
    
  </script>
</body>
</html>