<head>
  <title>Oven Timer App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>  
  </style>
  <script src="external/jquery-3.7.1.js"></script>  
  <script src="./external/easytimer.js-master/dist/easytimer.js""></script>
  </head>
<body>
  <div class="toggle-header">
    <button class="toggle-oven" id="oven-btn-1" onclick=toggleOven(1)>Oven 1</button>
    <button class="toggle-oven" id="oven-btn-2" onclick=toggleOven(2)>Oven 2</button>
    <button class="toggle-oven" id="oven-btn-3" onclick=toggleOven(3)>Oven 3</button>
  </div>
  <div class="oven-wrapper">
    <div class="oven" id="oven-1"">
      <div class="oven-info-input" id="oven-info-input-1">
        <p>Oven 1</p>
        <input type="text" id="oven-name-1">Name</input>
        <input type="number" onKeyDown="return false" min="0" max="300" value="10" step="10" id="oven-time-1">Time</input>
        <input type="number" onKeyDown="return false" min="100" max="300" value="200" step="10" id="oven-temperature-1">Temperature</input>
        <input type="number" onKeyDown="return false" max="12" min="2" step="2" value="2" id="oven-slots-1">Slots</input>
        <input type=text" id="oven-customer-1" value="ONT">Customer</input>
        <button onclick=createGrid(1)>SUBMIT</button>
      </div>
      <div class="oven-info-display">
      </div>
      <div class="oven-body" id="grid-1">
        <div class="slot">
          <div class="timer">
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function toggleOven(ovenNumber) {
      let ovenID = "#oven-" + (ovenNumber);

      if ($(ovenID).is(":visible")){
        $("#oven-"+(ovenNumber)).hide()
        $("#grid-"+(ovenNumber)).empty();
      } else {
        $("#oven-"+(ovenNumber)).show()
        $("#oven-info-input-" + (ovenNumber)).show()
      }
    }

    function createGrid(ovenNumber) {
      $("#oven-info-input-" + (ovenNumber)).hide()
      let slots = $("#oven-slots-" + ovenNumber).val()/2;
      let duration = $("#oven-time-" + ovenNumber).val()
      $("#grid-"+(ovenNumber)).empty();

      var gridContent = "<table>";
      for(i=1; i<=slots; i++) {
        gridContent +="<tr>"
        for(j=1;j<=2;j++){
          let currentSlot = {
            oven: ovenNumber,
            row: i,
            column: j,
            duration: duration,
          }
          let slotString = "oven-"+ ovenNumber + "-row-" + i + "-column-" + j;
          gridContent += "<td><button onclick=newTimer("+ JSON.stringify(currentSlot) +") ><div id="+ 
          slotString +">00:00:00</div></button><button onclick=removeTimer("+ JSON.stringify(currentSlot) +")>Remove</button</td>"
        }
        gridContent +="</tr>"
      }
      gridContent += "</table>"
      $("#grid-1").append(gridContent);
    }


    function newTimer(currentSlot) {
      // called on oven slot button press -> generates a timer with pre-entered settings
      let oven = currentSlot.oven;
      let row = currentSlot.row;
      let column = currentSlot.column;
      let duration = currentSlot.duration;

      var timerSlot = new ovenSlot(oven, row, column, duration) 
      timerSlot.createTimer()
    }

    function testFunction() {
      var testSlot = new ovenSlot()
      testSlot.createTimer()
    }

    var runningOvensList = []
    var allSlots = {
      oven1: {
        row1: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row2: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row3: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row4: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row5: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row6: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        }
      },
      oven2: {
        row1: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row2: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row3: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row4: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row5: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row6: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        }
      },
      oven3: {
        row1: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row2: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row3: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row4: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row5: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        },
        row6: {
          column1: {
            timer: false
          },
          column2: {
            timer: false
          },
        }
      },
    }

    class ovenSlot {
      // Constructor
      constructor(oven, row, column, duration) {
        this.oven = oven;
        this.row = row;
        this.column = column;
        this.slotString = createSlotString(oven, row, column);
        this.duration = duration;
      }


      // ovenSlot Methods
      createTimer() {
        // TODO FINISH USING THE DICTIONARY
        let slotID = '#' + this.slotString;
        if(runningOvensList.includes(slotID)){
          return
        } else {
          runningOvensList.push(slotID);
          eval("var " + this.slotString + '-timer = new easytimer.Timer();')
          // var timer = new easytimer.Timer();
          timer.start({countdown: true, startValues: {seconds: this.duration*60}});
          timer.addEventListener('secondsUpdated', function (e) {
            $(slotID).html(timer.getTimeValues().toString());

          }); 
          let timerAlert = (
            "Oven: "      + this.oven + 
            "\nRow: "     + this.row + 
            "\nColumn: "  + this.column + 
            "\nDone"
            )
          timer.addEventListener('targetAchieved', function (e) {
            alert(timerAlert);
            let ovenIndex = runningOvensList.indexOf(slotID)
            runningOvensList.splice(ovenIndex, 1)
          });
        }
      }
    }

    function removeTimer(currentSlot) {
      // find current slot
      // remove the timer from there
      let slotString = createSlotString(currentSlot.oven, currentSlot.row, currentSlot.column)
      let ovenIndex = runningOvensList.indexOf("#"+slotString)
      runningOvensList.splice(ovenIndex, 1)

    }

    function createSlotString(oven, row, column){
      let slotString = "oven-"+ oven + "-row-" + row + "-column-" + column;
      return slotString
    }
    
  </script>
</body>