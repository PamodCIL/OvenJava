<head>
  <title>Oven Timer App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>  
  </style>
  <script src="external/jquery-3.7.1.js"></script>  
  <script src="./external/easytimer.js-master/dist/easytimer.js""></script>
  </head>
<body>
  <div class="toggle-header">
    <button class="toggle-oven" id="oven-btn-1" onclick=toggleOven(1)>Oven 1</button>
    <button class="toggle-oven" id="oven-btn-2" onclick=toggleOven(2)>Oven 2</button>
    <button class="toggle-oven" id="oven-btn-3" onclick=toggleOven(3)>Oven 3</button>
  </div>
  <div class="oven-wrapper">
    <div class="oven" id="oven-1"">
      <div class="oven-info-input" id="oven-info-input-1">
        <p>Oven 1</p>
        <input type="text" id="oven-name">Name</input>
        <input type="number" onKeyDown="return false" min="100" max="300" value="200" step="10" id="oven-temperature">Temperature</input>
        <input type="number" onKeyDown="return false" max="12" min="2" step="2" value="2" id="oven-slots">Slots</input>
        <input type=text" id="swal-input4" value="ONT">Customer</input>
        <button onclick=createGrid(1)>SUBMIT</button>
      </div>
      <div class="oven-info-display">
      </div>
      <div class="oven-body" id="grid-1">
        <div class="slot">
          <div class="timer">
          </div>
        </div>
      </div>
    </div>
    <div id="oven-1-row-1-column-1">00:00:00</div>
    <button onclick=testFunction()>TEST</button>
  </div>
  <script>
    function toggleOven(ovenNumber) {
      let ovenID = "#oven-" + (ovenNumber);

      if ($(ovenID).is(":visible")){
        $("#oven-"+(ovenNumber)).hide()
        $("#grid-"+(ovenNumber)).empty();
      } else {
        $("#oven-"+(ovenNumber)).show()
        $("#oven-info-input-" + (ovenNumber)).show()
      }
    }

    function createGrid(ovenNumber) {
      $("#oven-info-input-" + (ovenNumber)).hide()
      slots = $("#oven-slots").val()/2;
      // create table with slots

      $("#grid-"+(ovenNumber)).empty();

      var gridContent = "<table>";
      for(i=1; i<=slots; i++) {
        gridContent +="<tr>"
        for(j=1;j<=2;j++){
          let currentSlot = {
            oven: ovenNumber,
            row: i,
            column: j,
          }
          let slotString = "oven-"+ ovenNumber + "-row-" + i + "-column-" + j;
          gridContent += "<td><button onclick=newTimer("+ JSON.stringify(currentSlot) +") ><div id="+ slotString +">00:00:00</div></button></td>"
        }
        gridContent +="</tr>"
      }
      gridContent += "</table>"
      $("#grid-1").append(gridContent);
      // put timer button in the slots
    }


    function newTimer(currentSlot) {
      // called on oven slot button press -> generates a timer with pre-entered settings
      let oven = currentSlot.oven;
      let row = currentSlot.row;
      let column = currentSlot.column;

      // TODO fix the ovenSlot constructor so that it takes the oven, row and column and constructs based on that

      var timerSlot = new ovenSlot(oven, row, column) 
      timerSlot.createTimer()
           
    }


    function testFunction() {
      var testSlot = new ovenSlot()
      testSlot.createTimer()
    }

    class ovenSlot {
      // Constructor
      constructor(oven, row, column, duration) {
        this.oven = oven;
        this.row = row;
        this.column = column;
        this.slotString = "oven-"+ this.oven + "-row-" + this.row + "-column-" + this.column;

        // this.duration = duration
      }


      // Methods
      // createTimer() {
      createTimer() {
        var timer = new easytimer.Timer();
        timer.start({countdown: true, startValues: {seconds: 5}});
        alert('#'+ this.slotString);
        timer.addEventListener('secondsUpdated', function (e) {
          // TODO FIX THIS
          // $('#'+ this.slotString).html(timer.getTimeValues().toString());
          $("#" + this.slotString).html(timer.getTimeValues().toString());

        }); 

        timer.addEventListener('targetAchieved', function (e) {
          alert("time done");
        });
      }
    }
    
  </script>
</body>